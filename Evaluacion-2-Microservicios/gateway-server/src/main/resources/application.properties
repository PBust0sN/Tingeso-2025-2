spring.application.name=gateway-server
spring.config.import=optional:configserver:http://config-server-service:8888
spring.cloud.config.enabled=true

# Security - Disable auto-configuration for both servlet and reactive
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.SecurityAutoConfiguration,\
  org.springframework.boot.autoconfigure.security.reactive.ReactiveSecurityAutoConfiguration,\
  org.springframework.boot.actuate.autoconfigure.security.servlet.ManagementWebSecurityAutoConfiguration,\
  org.springframework.boot.actuate.autoconfigure.security.reactive.ReactiveManagementWebSecurityAutoConfiguration

# Security user (optional fallback)
spring.security.user.name=guest
spring.security.user.password=guest

# Main application type
spring.main.web-application-type=reactive

# Gateway routes - Direct configuration
spring.cloud.gateway.routes[0].id=clients-service
spring.cloud.gateway.routes[0].uri=lb://ms-clients-service
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/clients/**
spring.cloud.gateway.routes[0].filters[0]=RewritePath=/api/clients(?<segment>/?.*), /clients$\{segment}

# Ruta alternativa para /api/clients sin trailing slash
spring.cloud.gateway.routes[1].id=clients-service-root
spring.cloud.gateway.routes[1].uri=lb://ms-clients-service
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/clients
spring.cloud.gateway.routes[1].filters[0]=RewritePath=/api/clients, /clients

# Deshabilitar auto-discovery de rutas por Eureka (usar solo rutas configuradas)
spring.cloud.gateway.discovery.locator.enabled=false

# CORS
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedOrigins=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedMethods=GET,POST,PUT,DELETE,OPTIONS,PATCH
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedHeaders=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowCredentials=false
spring.cloud.gateway.globalcors.cors-configurations.[/**].maxAge=3600

# Eureka
eureka.client.serviceUrl.defaultZone=http://eureka-service:8761/eureka/
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true

# Logging
logging.level.root=INFO
logging.level.org.springframework.cloud.gateway=DEBUG